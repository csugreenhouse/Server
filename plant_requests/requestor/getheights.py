#find all the heights of the plants in a folder and then return a list of their heights, along with a date and time stamp for each height measurement.

import time
import cv2
import sys
sys.path.append('/srv/samba/Server') 
import plant_requests.height_request.height_request as hr
import plant_requests.utils.reference_tag_util as reference_util
import database.database_util as database_util
import plant_requests.utils.graph_util as graph_util

# remove new lines in this string and make it into a list of file names

# make this into a string

raw_file_name_list = """20260115_155022.jpg  20260126_220025.jpg  20260201_163203.jpg  20260207_120526.jpg  20260208_204825.jpg  20260211_114655.jpg  20260213_142122.jpg  20260215_203519.jpg  20260217_141529.jpg
20260115_155142.jpg  20260127_153450.jpg  20260201_170204.jpg  20260207_120631.jpg  20260208_211850.jpg  20260211_121720.jpg  20260213_145127.jpg  20260215_210524.jpg  20260217_142952.jpg
20260115_155658.jpg  20260127_173508.jpg  20260201_190225.jpg  20260207_120712.jpg  20260208_214915.jpg  20260211_124745.jpg  20260213_152132.jpg  20260215_213530.jpg  20260217_144534.jpg
20260115_155708.jpg  20260127_183514.jpg  20260201_193227.jpg  20260207_120744.jpg  20260208_221940.jpg  20260211_131810.jpg  20260213_155138.jpg  20260215_220536.jpg  20260217_145957.jpg
20260115_155712.jpg  20260127_220547.jpg  20260201_203236.jpg  20260207_120833.jpg  20260208_225005.jpg  20260211_134835.jpg  20260213_162143.jpg  20260215_223541.jpg  20260217_151539.jpg
20260115_155730.jpg  20260127_230554.jpg  20260201_213245.jpg  20260207_120908.jpg  20260208_232030.jpg  20260211_135831.jpg  20260213_165148.jpg  20260215_230546.jpg  20260217_153002.jpg
20260115_155740.jpg  20260128_083900.jpg  20260202_090612.jpg  20260207_120929.jpg  20260208_235055.jpg  20260211_135852.jpg  20260213_172153.jpg  20260215_233552.jpg  20260217_154544.jpg
20260115_155744.jpg  20260128_090901.jpg  20260202_093614.jpg  20260207_121015.jpg  20260209_002119.jpg  20260211_150339.jpg  20260213_175158.jpg  20260216_000557.jpg  20260217_160008.jpg
20260115_155903.jpg  20260128_093902.jpg  20260202_103621.jpg  20260207_121112.jpg  20260209_083009.jpg  20260211_150647.jpg  20260213_182203.jpg  20260216_083940.jpg  20260217_161549.jpg
20260117_130407.jpg  20260128_100903.jpg  20260202_110623.jpg  20260207_121232.jpg  20260209_090034.jpg  20260211_150838.jpg  20260213_185208.jpg  20260216_090946.jpg  20260217_163013.jpg
20260123_155327.jpg  20260128_103905.jpg  20260202_113625.jpg  20260207_121314.jpg  20260209_093059.jpg  20260211_150943.jpg  20260213_192214.jpg  20260216_093951.jpg  20260217_164554.jpg
20260123_162331.jpg  20260128_110906.jpg  20260202_130640.jpg  20260207_121350.jpg  20260209_100124.jpg  20260211_151214.jpg  20260213_195219.jpg  20260216_100957.jpg  20260217_170018.jpg
20260124_120006.jpg  20260128_113907.jpg  20260202_133642.jpg  20260207_121415.jpg  20260209_103149.jpg  20260211_153800.jpg  20260213_202224.jpg  20260216_104002.jpg  20260217_171559.jpg
20260124_123452.jpg  20260128_120908.jpg  20260202_140643.jpg  20260207_121455.jpg  20260209_110213.jpg  20260211_153842.jpg  20260213_205229.jpg  20260216_111008.jpg  20260217_173023.jpg
20260124_123510.jpg  20260128_123910.jpg  20260202_143644.jpg  20260207_121546.jpg  20260209_113238.jpg  20260211_154224.jpg  20260213_212234.jpg  20260216_114013.jpg  20260217_174604.jpg
20260124_123628.jpg  20260128_130911.jpg  20260202_174129.jpg  20260207_121631.jpg  20260209_120303.jpg  20260211_154441.jpg  20260213_215239.jpg  20260216_121019.jpg  20260217_180028.jpg
20260124_123712.jpg  20260128_133913.jpg  20260202_174841.jpg  20260207_121659.jpg  20260209_123328.jpg  20260211_155343.jpg  20260213_222244.jpg  20260216_124024.jpg  20260217_181610.jpg
20260124_130716.jpg  20260128_140914.jpg  20260204_102011.jpg  20260207_121848.jpg  20260209_130353.jpg  20260211_160855.jpg  20260213_225249.jpg  20260216_131030.jpg  20260217_183033.jpg
20260124_133720.jpg  20260128_143915.jpg  20260204_111701.jpg  20260207_121918.jpg  20260209_133418.jpg  20260211_163900.jpg  20260213_232254.jpg  20260216_134035.jpg  20260217_184615.jpg
20260124_140724.jpg  20260128_150917.jpg  20260206_125500.jpg  20260207_121951.jpg  20260209_140443.jpg  20260211_170906.jpg  20260213_235259.jpg  20260216_153745.jpg  20260217_190039.jpg
20260124_143728.jpg  20260128_153920.jpg  20260206_125610.jpg  20260207_122009.jpg  20260209_143508.jpg  20260211_173911.jpg  20260214_002304.jpg  20260216_153944.jpg  20260217_191620.jpg
20260124_152148.jpg  20260128_160922.jpg  20260206_125705.jpg  20260207_122419.jpg  20260209_150533.jpg  20260211_180917.jpg  20260214_082635.jpg  20260216_160949.jpg  20260217_193044.jpg
20260124_155152.jpg  20260128_163923.jpg  20260206_132731.jpg  20260207_122445.jpg  20260209_153605.jpg  20260211_183922.jpg  20260214_085640.jpg  20260216_162351.jpg  20260217_194625.jpg
20260124_162153.jpg  20260128_170924.jpg  20260206_135753.jpg  20260207_122605.jpg  20260209_160630.jpg  20260211_190928.jpg  20260214_092646.jpg  20260216_163954.jpg  20260217_200049.jpg
20260124_165154.jpg  20260128_173926.jpg  20260206_142815.jpg  20260207_122701.jpg  20260209_163655.jpg  20260211_193933.jpg  20260214_095651.jpg  20260216_165356.jpg  20260217_201630.jpg
20260124_172155.jpg  20260128_180929.jpg  20260206_145837.jpg  20260207_122802.jpg  20260209_170720.jpg  20260211_200939.jpg  20260214_102656.jpg  20260216_171000.jpg  20260217_203054.jpg
20260124_175157.jpg  20260128_183930.jpg  20260206_150255.jpg  20260207_124103.jpg  20260209_173745.jpg  20260211_203944.jpg  20260214_105702.jpg  20260216_172401.jpg  20260217_204635.jpg
20260124_182158.jpg  20260128_190932.jpg  20260206_150512.jpg  20260207_124630.jpg  20260209_180809.jpg  20260211_210950.jpg  20260214_112708.jpg  20260216_174005.jpg  20260217_210059.jpg
20260124_185159.jpg  20260128_193934.jpg  20260206_150543.jpg  20260207_124718.jpg  20260209_183834.jpg  20260211_213955.jpg  20260214_115713.jpg  20260216_175406.jpg  20260217_211640.jpg
20260124_192200.jpg  20260128_200937.jpg  20260206_150628.jpg  20260207_124832.jpg  20260209_190859.jpg  20260211_221001.jpg  20260214_122718.jpg  20260216_181010.jpg  20260217_213104.jpg
20260124_195201.jpg  20260128_203939.jpg  20260206_151029.jpg  20260207_124954.jpg  20260209_193924.jpg  20260211_224006.jpg  20260214_125724.jpg  20260216_182411.jpg  20260217_214645.jpg
20260124_202203.jpg  20260128_210940.jpg  20260206_151101.jpg  20260207_132019.jpg  20260209_200949.jpg  20260211_231012.jpg  20260214_132729.jpg  20260216_184015.jpg  20260217_215545.jpg
20260124_205204.jpg  20260128_213942.jpg  20260206_151118.jpg  20260207_135044.jpg  20260209_204014.jpg  20260211_234017.jpg  20260214_135735.jpg  20260216_185416.jpg  20260217_221650.jpg
20260124_212205.jpg  20260128_220947.jpg  20260206_153338.jpg  20260207_142109.jpg  20260209_211039.jpg  20260212_001023.jpg  20260214_142740.jpg  20260216_191020.jpg  20260217_222550.jpg
20260124_215207.jpg  20260128_223948.jpg  20260206_164726.jpg  20260207_145134.jpg  20260209_214103.jpg  20260212_084406.jpg  20260214_145746.jpg  20260216_192422.jpg  20260217_223854.jpg
20260124_222208.jpg  20260128_230950.jpg  20260206_164836.jpg  20260207_152159.jpg  20260209_221128.jpg  20260212_091411.jpg  20260214_152751.jpg  20260216_194025.jpg  20260217_224058.jpg
20260124_225209.jpg  20260128_233952.jpg  20260206_164924.jpg  20260207_155224.jpg  20260209_224153.jpg  20260212_094416.jpg  20260214_155757.jpg  20260216_195427.jpg  20260217_224140.jpg
20260124_232210.jpg  20260129_000954.jpg  20260206_165151.jpg  20260207_162249.jpg  20260209_231218.jpg  20260212_101421.jpg  20260214_162802.jpg  20260216_201030.jpg  20260217_224214.jpg
20260124_235212.jpg  20260129_084247.jpg  20260206_165238.jpg  20260207_165314.jpg  20260209_234243.jpg  20260212_104426.jpg  20260214_165808.jpg  20260216_202432.jpg  20260217_224649.jpg
20260125_002213.jpg  20260129_091248.jpg  20260206_165435.jpg  20260207_172339.jpg  20260210_001308.jpg  20260212_111431.jpg  20260214_172813.jpg  20260216_204035.jpg  20260217_224655.jpg
20260125_082456.jpg  20260129_094252.jpg  20260206_165626.jpg  20260207_175405.jpg  20260210_085230.jpg  20260212_114436.jpg  20260214_175819.jpg  20260216_205437.jpg  20260217_231700.jpg
20260125_085457.jpg  20260129_101255.jpg  20260206_165719.jpg  20260207_182430.jpg  20260210_092255.jpg  20260212_121441.jpg  20260214_182824.jpg  20260216_211040.jpg  20260217_231701.jpg
20260125_092458.jpg  20260129_111302.jpg  20260206_170002.jpg  20260207_185454.jpg  20260210_095320.jpg  20260212_124446.jpg  20260214_185829.jpg  20260216_212442.jpg  20260217_234706.jpg
20260125_095459.jpg  20260129_114303.jpg  20260206_170028.jpg  20260207_192520.jpg  20260210_102345.jpg  20260212_131451.jpg  20260214_192835.jpg  20260216_214045.jpg  20260217_234710.jpg
20260125_102501.jpg  20260129_121305.jpg  20260206_170121.jpg  20260207_195545.jpg  20260210_105410.jpg  20260212_134456.jpg  20260214_195840.jpg  20260216_215447.jpg  20260218_001711.jpg
20260125_105502.jpg  20260129_124306.jpg  20260206_170146.jpg  20260207_202610.jpg  20260210_112435.jpg  20260212_141501.jpg  20260214_202846.jpg  20260216_221050.jpg  20260218_001722.jpg
20260125_112503.jpg  20260129_131308.jpg  20260206_173208.jpg  20260207_205635.jpg  20260210_115500.jpg  20260212_144507.jpg  20260214_205851.jpg  20260216_222452.jpg  20260218_085032.jpg
20260125_115504.jpg  20260129_141315.jpg  20260206_180230.jpg  20260207_212700.jpg  20260210_122525.jpg  20260212_151512.jpg  20260214_212857.jpg  20260216_224055.jpg  20260218_085051.jpg
20260125_122505.jpg  20260129_151322.jpg  20260206_183252.jpg  20260207_215725.jpg  20260210_125550.jpg  20260212_154517.jpg  20260214_215903.jpg  20260216_225457.jpg  20260218_092037.jpg
20260125_125506.jpg  20260129_171338.jpg  20260206_190313.jpg  20260207_222750.jpg  20260210_132616.jpg  20260212_161522.jpg  20260214_222908.jpg  20260216_231100.jpg  20260218_092102.jpg
20260125_132508.jpg  20260129_194359.jpg  20260206_193336.jpg  20260207_225815.jpg  20260210_135640.jpg  20260212_164527.jpg  20260214_225914.jpg  20260216_232502.jpg  20260218_095007.jpg
20260125_135509.jpg  20260129_204408.jpg  20260206_200357.jpg  20260207_232840.jpg  20260210_142706.jpg  20260212_171532.jpg  20260214_232919.jpg  20260216_234106.jpg  20260218_095042.jpg
20260125_142510.jpg  20260130_001440.jpg  20260206_203419.jpg  20260207_235905.jpg  20260210_145731.jpg  20260212_174537.jpg  20260214_235925.jpg  20260216_235507.jpg  20260218_095317.jpg
20260125_145511.jpg  20260130_132134.jpg  20260206_210441.jpg  20260208_083827.jpg  20260210_152756.jpg  20260212_181543.jpg  20260215_083308.jpg  20260217_001111.jpg  20260218_095544.jpg
20260125_152512.jpg  20260130_135135.jpg  20260206_213502.jpg  20260208_090852.jpg  20260210_155821.jpg  20260212_184548.jpg  20260215_090313.jpg  20260217_082850.jpg  20260218_102048.jpg
20260125_155514.jpg  20260131_172733.jpg  20260206_220524.jpg  20260208_093917.jpg  20260210_162846.jpg  20260212_191553.jpg  20260215_093319.jpg  20260217_084432.jpg  20260218_102605.jpg
20260125_162515.jpg  20260131_185745.jpg  20260206_223546.jpg  20260208_100942.jpg  20260210_165911.jpg  20260212_194558.jpg  20260215_100324.jpg  20260217_085855.jpg  20260218_105053.jpg
20260125_165516.jpg  20260131_192748.jpg  20260206_230608.jpg  20260208_104007.jpg  20260210_172936.jpg  20260212_201603.jpg  20260215_103330.jpg  20260217_091437.jpg  20260218_105627.jpg
20260125_172517.jpg  20260131_195750.jpg  20260206_233630.jpg  20260208_111032.jpg  20260210_180001.jpg  20260212_204608.jpg  20260215_110335.jpg  20260217_092900.jpg  20260218_112058.jpg
20260125_175518.jpg  20260131_205758.jpg  20260207_000651.jpg  20260208_114057.jpg  20260210_183027.jpg  20260212_211613.jpg  20260215_113341.jpg  20260217_094442.jpg  20260218_112649.jpg
20260125_182519.jpg  20260131_212800.jpg  20260207_084525.jpg  20260208_121122.jpg  20260210_190052.jpg  20260212_214618.jpg  20260215_120346.jpg  20260217_095906.jpg  20260218_115103.jpg
20260125_185521.jpg  20260131_222806.jpg  20260207_091547.jpg  20260208_124147.jpg  20260210_193117.jpg  20260212_221623.jpg  20260215_123351.jpg  20260217_101447.jpg  20260218_115711.jpg
20260125_192522.jpg  20260131_232816.jpg  20260207_094611.jpg  20260208_131211.jpg  20260210_200142.jpg  20260212_224629.jpg  20260215_130357.jpg  20260217_102911.jpg  20260218_122108.jpg
20260125_195523.jpg  20260201_090123.jpg  20260207_101643.jpg  20260208_134236.jpg  20260210_203207.jpg  20260212_231634.jpg  20260215_133402.jpg  20260217_104453.jpg  20260218_122732.jpg
20260125_202525.jpg  20260201_100130.jpg  20260207_104708.jpg  20260208_141301.jpg  20260210_210233.jpg  20260212_234639.jpg  20260215_140408.jpg  20260217_105916.jpg  20260218_125113.jpg
20260125_205527.jpg  20260201_103132.jpg  20260207_111733.jpg  20260208_144326.jpg  20260210_213258.jpg  20260213_001644.jpg  20260215_143413.jpg  20260217_111458.jpg  20260218_131649.jpg
20260125_212528.jpg  20260201_110133.jpg  20260207_113645.jpg  20260208_151351.jpg  20260210_220323.jpg  20260213_085026.jpg  20260215_150419.jpg  20260217_112921.jpg  20260218_132118.jpg
20260125_215530.jpg  20260201_113134.jpg  20260207_113754.jpg  20260208_154416.jpg  20260210_223348.jpg  20260213_092031.jpg  20260215_153424.jpg  20260217_114503.jpg  20260218_134710.jpg
20260125_222531.jpg  20260201_120136.jpg  20260207_114042.jpg  20260208_161441.jpg  20260210_230413.jpg  20260213_095036.jpg  20260215_160430.jpg  20260217_115926.jpg  20260218_135124.jpg
20260125_225532.jpg  20260201_123137.jpg  20260207_114057.jpg  20260208_164506.jpg  20260210_233438.jpg  20260213_102041.jpg  20260215_163435.jpg  20260217_121508.jpg  20260218_140223.jpg
20260125_232533.jpg  20260201_130141.jpg  20260207_114114.jpg  20260208_171531.jpg  20260211_000503.jpg  20260213_105047.jpg  20260215_170441.jpg  20260217_122931.jpg
20260125_235535.jpg  20260201_133143.jpg  20260207_114204.jpg  20260208_174556.jpg  20260211_084425.jpg  20260213_112052.jpg  20260215_173446.jpg  20260217_124513.jpg
20260126_082828.jpg  20260201_140144.jpg  20260207_115735.jpg  20260208_181621.jpg  20260211_091450.jpg  20260213_115057.jpg  20260215_180452.jpg  20260217_125936.jpg
20260126_085829.jpg  20260201_143145.jpg  20260207_115822.jpg  20260208_184645.jpg  20260211_094515.jpg  20260213_122102.jpg  20260215_183457.jpg  20260217_131519.jpg
20260126_092831.jpg  20260201_150149.jpg  20260207_120107.jpg  20260208_191710.jpg  20260211_101540.jpg  20260213_125107.jpg  20260215_190503.jpg  20260217_132942.jpg
20260126_095832.jpg  20260201_153156.jpg  20260207_120301.jpg  20260208_194736.jpg  20260211_104605.jpg  20260213_132112.jpg  20260215_193508.jpg  20260217_134524.jpg
20260126_102834.jpg  20260201_160202.jpg  20260207_120435.jpg  20260208_201801.jpg  20260211_111630.jpg  20260213_135117.jpg  20260215_200513.jpg  20260217_135947.jpg
"""




def main():
    main_file_path = "/srv/samba/plants/image/by_plant/plant3/"
    processed_file_path = "/srv/samba/plants/image/by_plant/plant3/processed/"
    conn = database_util.open_connection_to_database()

    #narrow green bounds for basil

    database_util.set_color_bounds_for_species_in_database(conn, 3, ((35, 140, 60), (85, 255, 255)))

    camera_parameters = database_util.get_available_camera_parameters_from_database(conn)

    # remove new lines
    raw_file_name_list_no_new_lines = raw_file_name_list.replace("\n", " ")
    file_names = raw_file_name_list_no_new_lines.split(" ")
    file_names = [file_name for file_name in file_names if file_name != ""] # remove empty strings from the list

    for file_name in file_names:
        print(f"Processing file: {file_name}")
        # Open the image file
        file_path = main_file_path + file_name
        try: 
            image = cv2.imread(file_path)
            reference_tags = reference_util.scan_reference_tags(image, camera_parameters=camera_parameters[0], conn=conn)
            height_response = hr.height_request(image, reference_tags, camera_parameters=camera_parameters[0])
            print(f"{file_name}: {height_response[0]['estimated_height']} cm")
            processed_file_name = processed_file_path + file_name
            graph_util.plot_height_request_response(image, processed_file_name, height_response)
            print(f"Saved processed image to {processed_file_name}")
            timestamp = file_name.split('.')[0] 
            database_util.insert_height_response_into_database(conn, height_response[0], file_path, processed_file_name, timestamp)
        except Exception as e:
            print(f"Error reading image {file_path}: {e}")
            continue    
        
    database_util.close_connection_to_database(conn)

main()
